# Billing System - Phase 2 Enhancements

## ASCII Architecture Diagram - Phase 2 Features

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PHASE 2 ENHANCEMENTS OVERVIEW                            â”‚
â”‚                      (Post-MVP Advanced Features)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ENHANCED EMAIL NOTIFICATION SYSTEM (7 Additional Templates)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Phase 1: 3 Critical Emails âœ…
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    âœ“ Payment Failed
    âœ“ Trial Ending (3 days)
    âœ“ Payment Receipt


    Phase 2: 7 Additional Emails ğŸ”œ
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  1. USAGE WARNING EMAIL (80% Threshold)                            â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
    â”‚  Trigger: credit_balance reaches 80% for any tier                  â”‚
    â”‚  Frequency: Once per tier per billing period                       â”‚
    â”‚  Content:                                                          â”‚
    â”‚    â€¢ Current usage: 2,000 / 2,500 Large actions (80%)             â”‚
    â”‚    â€¢ Remaining: 500 Large actions                                  â”‚
    â”‚    â€¢ Days left in period: 12 days                                  â”‚
    â”‚    â€¢ CTA: [Buy More Credits] or [Upgrade Plan]                    â”‚
    â”‚                                                                    â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚  Subject: âš ï¸ You've used 80% of your Large actions          â”‚ â”‚
    â”‚  â”‚                                                              â”‚ â”‚
    â”‚  â”‚  Hi Team,                                                    â”‚ â”‚
    â”‚  â”‚                                                              â”‚ â”‚
    â”‚  â”‚  You've used 2,000 out of 2,500 Large actions this month.   â”‚ â”‚
    â”‚  â”‚  With 12 days left, you may want to:                        â”‚ â”‚
    â”‚  â”‚                                                              â”‚ â”‚
    â”‚  â”‚  â€¢ Buy 500 credits for $20                                  â”‚ â”‚
    â”‚  â”‚  â€¢ Upgrade to Pro (500 Large actions/month)                 â”‚ â”‚
    â”‚  â”‚                                                              â”‚ â”‚
    â”‚  â”‚  [View Usage] [Buy Credits] [Upgrade Plan]                  â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  2. USAGE LIMIT REACHED EMAIL (100% Threshold)                     â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
    â”‚  Trigger: credit_balance reaches 100% for any tier                 â”‚
    â”‚  Frequency: Once per tier per billing period                       â”‚
    â”‚  Content:                                                          â”‚
    â”‚    â€¢ Blocked tier: Large actions (2,500 / 2,500)                  â”‚
    â”‚    â€¢ Impact: Cannot execute Large actions until upgrade/top-up     â”‚
    â”‚    â€¢ Urgent CTA: [Buy Credits Now] or [Upgrade Immediately]       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  3. AUTO TOP-UP TRIGGERED EMAIL                                    â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
    â”‚  Trigger: Auto top-up payment processed                            â”‚
    â”‚  Content:                                                          â”‚
    â”‚    â€¢ Credits added: 500 credits ($20)                             â”‚
    â”‚    â€¢ New balance: 530 total credits                                â”‚
    â”‚    â€¢ Payment method: â€¢â€¢â€¢â€¢ 4242                                     â”‚
    â”‚    â€¢ Receipt: [View Invoice PDF]                                   â”‚
    â”‚    â€¢ Manage: [Update Auto Top-Up Settings]                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  4. SUBSCRIPTION UPGRADED EMAIL                                    â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
    â”‚  Trigger: Plan tier changed (upgrade)                              â”‚
    â”‚  Content:                                                          â”‚
    â”‚    â€¢ Old plan: Starter ($9.99/mo)                                 â”‚
    â”‚    â€¢ New plan: Pro ($99/mo)                                       â”‚
    â”‚    â€¢ Prorated charge: $82.50 (for 23 days remaining)              â”‚
    â”‚    â€¢ New credit allocations per tier                               â”‚
    â”‚    â€¢ Next billing date                                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  5. SUBSCRIPTION DOWNGRADED EMAIL                                  â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
    â”‚  Trigger: Plan tier changed (downgrade)                            â”‚
    â”‚  Content:                                                          â”‚
    â”‚    â€¢ New plan: Starter ($9.99/mo)                                 â”‚
    â”‚    â€¢ Change effective: End of billing period (Dec 31)              â”‚
    â”‚    â€¢ Credit on next invoice: $76.50                               â”‚
    â”‚    â€¢ New limits starting Jan 1                                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  6. TRIAL STARTED (WELCOME) EMAIL                                  â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
    â”‚  Trigger: Subscription created with trial                          â”‚
    â”‚  Content:                                                          â”‚
    â”‚    â€¢ Welcome message                                               â”‚
    â”‚    â€¢ Trial details: 7 days, ends Dec 24                           â”‚
    â”‚    â€¢ What's included in Pro plan                                   â”‚
    â”‚    â€¢ Getting started guide                                         â”‚
    â”‚    â€¢ No payment required during trial                              â”‚
    â”‚    â€¢ [Get Started] [View Dashboard]                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  7. DOWNGRADED TO FREE TIER EMAIL                                  â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
    â”‚  Trigger: Payment failed â†’ grace period expired â†’ downgrade        â”‚
    â”‚  Content:                                                          â”‚
    â”‚    â€¢ Reason: Payment failure after grace period                    â”‚
    â”‚    â€¢ New plan: Free (10/4/2/1 actions)                            â”‚
    â”‚    â€¢ What you've lost (compared to previous plan)                  â”‚
    â”‚    â€¢ How to reactivate: Update payment method                      â”‚
    â”‚    â€¢ [Update Payment Method] [Reactivate Subscription]            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    Email Template Architecture:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Event Trigger  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Email Queue    â”‚
    â”‚  (webhook/cron) â”‚         â”‚  (async job)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚  Template       â”‚
                                â”‚  Renderer       â”‚
                                â”‚  (@react-email) â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚  AWS SES        â”‚
                                â”‚  Send Email     â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ADVANCED ANALYTICS DASHBOARD                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    New Database Tables/Views:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CREATE TABLE usage_trends (                                       â”‚
    â”‚    org_id CHAR(36),                                                â”‚
    â”‚    period DATE,  -- Daily/Weekly/Monthly                           â”‚
    â”‚    period_type ENUM('day', 'week', 'month'),                       â”‚
    â”‚    action_tier ENUM('small', 'medium', 'large', 'xl'),            â”‚
    â”‚    total_actions INT,                                              â”‚
    â”‚    total_credits DECIMAL(10,2),                                    â”‚
    â”‚    unique_users INT,                                               â”‚
    â”‚    avg_actions_per_user DECIMAL(10,2),                             â”‚
    â”‚    peak_hour INT,                                                  â”‚
    â”‚    created_at TIMESTAMP                                            â”‚
    â”‚  );                                                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CREATE TABLE spending_forecasts (                                 â”‚
    â”‚    org_id CHAR(36),                                                â”‚
    â”‚    forecast_date DATE,                                             â”‚
    â”‚    predicted_small INT,                                            â”‚
    â”‚    predicted_medium INT,                                           â”‚
    â”‚    predicted_large INT,                                            â”‚
    â”‚    predicted_xl INT,                                               â”‚
    â”‚    predicted_overage_cost DECIMAL(10,2),                           â”‚
    â”‚    confidence_score DECIMAL(3,2),  -- 0.00 to 1.00                â”‚
    â”‚    algorithm VARCHAR(50),  -- 'linear', 'moving_avg', etc.        â”‚
    â”‚    created_at TIMESTAMP                                            â”‚
    â”‚  );                                                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CREATE TABLE budget_alerts (                                      â”‚
    â”‚    id CHAR(36) PRIMARY KEY,                                        â”‚
    â”‚    org_id CHAR(36),                                                â”‚
    â”‚    alert_type ENUM('daily', 'weekly', 'monthly'),                 â”‚
    â”‚    threshold_amount DECIMAL(10,2),  -- $ amount                    â”‚
    â”‚    threshold_credits INT,           -- OR credit count             â”‚
    â”‚    current_amount DECIMAL(10,2),                                   â”‚
    â”‚    triggered_at TIMESTAMP,                                         â”‚
    â”‚    status ENUM('active', 'triggered', 'resolved'),                â”‚
    â”‚    notification_sent BOOLEAN                                       â”‚
    â”‚  );                                                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    Dashboard UI Components:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ADVANCED ANALYTICS TAB (/settings/billing/analytics)             â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
    â”‚                                                                    â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚  Usage Trends (Last 30 Days)                                 â”‚ â”‚
    â”‚  â”‚                                                              â”‚ â”‚
    â”‚  â”‚    3000 â”¤                                        â•­â”€â•®        â”‚ â”‚
    â”‚  â”‚         â”‚                              â•­â”€â•®       â”‚ â”‚        â”‚ â”‚
    â”‚  â”‚    2000 â”¤                    â•­â”€â•®       â”‚ â”‚  â•­â”€â•®  â”‚ â”‚        â”‚ â”‚
    â”‚  â”‚         â”‚          â•­â”€â•®       â”‚ â”‚  â•­â”€â•®  â”‚ â”‚  â”‚ â”‚  â”‚ â”‚        â”‚ â”‚
    â”‚  â”‚    1000 â”¤     â•­â”€â•®  â”‚ â”‚  â•­â”€â•®  â”‚ â”‚  â”‚ â”‚  â”‚ â”‚  â”‚ â”‚  â”‚ â”‚        â”‚ â”‚
    â”‚  â”‚         â”‚â”€â”€â”€â”€â”€â”‚ â”‚â”€â”€â”‚ â”‚â”€â”€â”‚ â”‚â”€â”€â”‚ â”‚â”€â”€â”‚ â”‚â”€â”€â”‚ â”‚â”€â”€â”‚ â”‚â”€â”€â”‚ â”‚â”€â”€â”€â”€    â”‚ â”‚
    â”‚  â”‚       0 â”´â”€â”€â”€â”€â”€â”´â”€â”´â”€â”€â”´â”€â”´â”€â”€â”´â”€â”´â”€â”€â”´â”€â”´â”€â”€â”´â”€â”´â”€â”€â”´â”€â”´â”€â”€â”´â”€â”´â”€â”€â”´â”€â”´â”€â”€â”€â”€    â”‚ â”‚
    â”‚  â”‚           Dec 1    Dec 8   Dec 15   Dec 22   Dec 29          â”‚ â”‚
    â”‚  â”‚                                                              â”‚ â”‚
    â”‚  â”‚  Legend: â–  Small  â–  Medium  â–  Large  â–  XL                   â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚                                                                    â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚  Spending Forecast (Next 30 Days)                            â”‚ â”‚
    â”‚  â”‚                                                              â”‚ â”‚
    â”‚  â”‚  Based on current usage trends:                              â”‚ â”‚
    â”‚  â”‚  â€¢ Predicted actions: 8,450 (confidence: 87%)                â”‚ â”‚
    â”‚  â”‚  â€¢ Estimated overage: $45                                    â”‚ â”‚
    â”‚  â”‚  â€¢ Recommendation: Consider upgrading to Pro                 â”‚ â”‚
    â”‚  â”‚                                                              â”‚ â”‚
    â”‚  â”‚  [Set Budget Alert] [View Detailed Forecast]                â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚                                                                    â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚  Peak Usage Times                                            â”‚ â”‚
    â”‚  â”‚                                                              â”‚ â”‚
    â”‚  â”‚  Hour  â”‚ Mon  Tue  Wed  Thu  Fri  Sat  Sun                  â”‚ â”‚
    â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”‚ â”‚
    â”‚  â”‚  09:00 â”‚ â–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆ                   â”‚ â”‚
    â”‚  â”‚  14:00 â”‚ â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆ                   â”‚ â”‚
    â”‚  â”‚  18:00 â”‚ â–ˆâ–ˆ   â–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ                   â”‚ â”‚
    â”‚  â”‚                                                              â”‚ â”‚
    â”‚  â”‚  Insight: Peak usage 2-3pm weekdays. Consider batch jobs     â”‚ â”‚
    â”‚  â”‚           during off-peak hours to spread usage.             â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚                                                                    â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚  Team Member Usage Breakdown (Sortable)                      â”‚ â”‚
    â”‚  â”‚                                                              â”‚ â”‚
    â”‚  â”‚  User            Actions  Credits  Cost    % of Org         â”‚ â”‚
    â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€          â”‚ â”‚
    â”‚  â”‚  sarah@co.com    1,284    3,210    $64.20  42%  [Set Quota]â”‚ â”‚
    â”‚  â”‚  mike@co.com     1,209    3,022    $60.44  39%  [Set Quota]â”‚ â”‚
    â”‚  â”‚  john@co.com       671    1,677    $33.54  19%  [Set Quota]â”‚ â”‚
    â”‚  â”‚                                                              â”‚ â”‚
    â”‚  â”‚  [Export CSV] [Set Team Quotas]                             â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. TEAM MEMBER QUOTAS (Per-User Hard Limits)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    New Database Table:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CREATE TABLE user_quotas (                                        â”‚
    â”‚    org_id CHAR(36),                                                â”‚
    â”‚    user_id VARCHAR(128),                                           â”‚
    â”‚                                                                    â”‚
    â”‚    -- Monthly limits per user                                     â”‚
    â”‚    quota_small INT,                                                â”‚
    â”‚    quota_medium INT,                                               â”‚
    â”‚    quota_large INT,                                                â”‚
    â”‚    quota_xl INT,                                                   â”‚
    â”‚                                                                    â”‚
    â”‚    -- Current usage (resets monthly)                              â”‚
    â”‚    used_small INT DEFAULT 0,                                       â”‚
    â”‚    used_medium INT DEFAULT 0,                                      â”‚
    â”‚    used_large INT DEFAULT 0,                                       â”‚
    â”‚    used_xl INT DEFAULT 0,                                          â”‚
    â”‚                                                                    â”‚
    â”‚    quota_period_start TIMESTAMP,                                   â”‚
    â”‚    quota_period_end TIMESTAMP,                                     â”‚
    â”‚                                                                    â”‚
    â”‚    PRIMARY KEY (org_id, user_id),                                  â”‚
    â”‚    FOREIGN KEY (org_id) REFERENCES organizations(id),              â”‚
    â”‚    FOREIGN KEY (user_id) REFERENCES users(id)                      â”‚
    â”‚  );                                                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    Enforcement Flow:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    User Request                API                         Database
         â”‚                       â”‚                             â”‚
         â”‚ POST /api/billing     â”‚                             â”‚
         â”‚   /usage/record       â”‚                             â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                             â”‚
         â”‚                       â”‚ Check ORG credit_balance    â”‚
         â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
         â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                       â”‚                             â”‚
         â”‚                       â”‚ âœ“ Org has credits           â”‚
         â”‚                       â”‚                             â”‚
         â”‚                       â”‚ Check USER quota (NEW!)     â”‚
         â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
         â”‚                       â”‚ SELECT * FROM user_quotas   â”‚
         â”‚                       â”‚ WHERE user_id = ...         â”‚
         â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                       â”‚                             â”‚
         â”‚                       â”‚ IF used_large >= quota_largeâ”‚
         â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                             â”‚
         â”‚ 402 Payment Required  â”‚   Return USER_QUOTA_EXCEEDEDâ”‚
         â”‚ { error: 'USER_      â”‚                             â”‚
         â”‚   QUOTA_EXCEEDED' }   â”‚                             â”‚
         â”‚                       â”‚                             â”‚
         â”‚                       â”‚ ELSE: Allow action          â”‚
         â”‚                       â”‚ Update org balance          â”‚
         â”‚                       â”‚ Update user quota           â”‚
         â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
         â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                             â”‚
         â”‚ 200 OK                â”‚                             â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    UI: Set User Quota Modal
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Set Quota for sarah@co.com                â”‚
    â”‚                                            â”‚
    â”‚  Monthly limits (leave blank for no limit) â”‚
    â”‚                                            â”‚
    â”‚  Small actions:   [  500  ]                â”‚
    â”‚  Medium actions:  [  200  ]                â”‚
    â”‚  Large actions:   [  100  ]                â”‚
    â”‚  XL actions:      [   20  ]                â”‚
    â”‚                                            â”‚
    â”‚  Current usage this month:                 â”‚
    â”‚  â€¢ Small:  320 / 500  (64%)                â”‚
    â”‚  â€¢ Medium: 120 / 200  (60%)                â”‚
    â”‚  â€¢ Large:   89 / 100  (89%) âš ï¸             â”‚
    â”‚  â€¢ XL:      12 /  20  (60%)                â”‚
    â”‚                                            â”‚
    â”‚  [Cancel]  [Save Quota]                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ENTERPRISE FEATURES                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    A. ANNUAL BILLING (Discounted)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    New Stripe Products:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â€¢ Starter Annual:  $99.99/year   (save $19.89 vs monthly)
    â€¢ Pro Annual:      $999.99/year  (save $188.01 vs monthly)
    â€¢ Max Annual:      $4,999/year   (save $999.88 vs monthly)

    Database Schema Addition:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ALTER TABLE subscriptions
      ADD COLUMN billing_interval ENUM('month', 'year') DEFAULT 'month';

    UI: Plan Selection
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Choose Billing Cycle                                  â”‚
    â”‚                                                        â”‚
    â”‚  â—‹ Monthly    $99.00/mo                                â”‚
    â”‚  â— Annual     $999.99/year  ğŸ’° Save $188 (16% off!)   â”‚
    â”‚                                                        â”‚
    â”‚  [Subscribe Now]                                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    B. CUSTOM ENTERPRISE PLANS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    New Database Table:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CREATE TABLE enterprise_plans (                                   â”‚
    â”‚    id CHAR(36) PRIMARY KEY,                                        â”‚
    â”‚    org_id CHAR(36) UNIQUE,                                         â”‚
    â”‚    plan_name VARCHAR(120),                                         â”‚
    â”‚    custom_pricing DECIMAL(10,2),                                   â”‚
    â”‚                                                                    â”‚
    â”‚    -- Custom credit allocations                                   â”‚
    â”‚    custom_small INT,                                               â”‚
    â”‚    custom_medium INT,                                              â”‚
    â”‚    custom_large INT,                                               â”‚
    â”‚    custom_xl INT,                                                  â”‚
    â”‚                                                                    â”‚
    â”‚    -- Enterprise features                                         â”‚
    â”‚    dedicated_support BOOLEAN DEFAULT true,                         â”‚
    â”‚    sla_response_time_hours INT,  -- 1, 4, 24                      â”‚
    â”‚    custom_contract_terms TEXT,                                     â”‚
    â”‚    minimum_commitment_months INT,                                  â”‚
    â”‚                                                                    â”‚
    â”‚    effective_date DATE,                                            â”‚
    â”‚    expiration_date DATE,                                           â”‚
    â”‚    sales_contact_email VARCHAR(320)                                â”‚
    â”‚  );                                                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    C. MULTI-CURRENCY SUPPORT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Supported Currencies:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â€¢ USD (default)
    â€¢ EUR
    â€¢ GBP
    â€¢ CAD
    â€¢ AUD

    Database Changes:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ALTER TABLE subscriptions
      ADD COLUMN currency CHAR(3) DEFAULT 'USD';

    ALTER TABLE credit_purchases
      MODIFY COLUMN currency CHAR(3) DEFAULT 'USD';

    Pricing Table:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CREATE TABLE pricing_by_currency (                                â”‚
    â”‚    plan_tier ENUM('starter', 'pro', 'max'),                       â”‚
    â”‚    currency CHAR(3),                                               â”‚
    â”‚    monthly_price DECIMAL(10,2),                                    â”‚
    â”‚    annual_price DECIMAL(10,2),                                     â”‚
    â”‚    credit_pack_price DECIMAL(10,2),  -- 500 credits                â”‚
    â”‚    PRIMARY KEY (plan_tier, currency)                               â”‚
    â”‚  );                                                                â”‚
    â”‚                                                                    â”‚
    â”‚  INSERT INTO pricing_by_currency VALUES                            â”‚
    â”‚    ('starter', 'USD',  9.99,  99.99, 20.00),                      â”‚
    â”‚    ('starter', 'EUR',  8.99,  89.99, 18.00),                      â”‚
    â”‚    ('starter', 'GBP',  7.99,  79.99, 16.00),                      â”‚
    â”‚    ('pro',     'USD', 99.00, 999.99, 20.00),                      â”‚
    â”‚    ('pro',     'EUR', 89.00, 899.99, 18.00),                      â”‚
    â”‚    ('pro',     'GBP', 79.00, 799.99, 16.00);                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. MARKETING & GROWTH FEATURES                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    A. COUPON / PROMO CODE SYSTEM
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Database Tables:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CREATE TABLE coupons (                                            â”‚
    â”‚    id CHAR(36) PRIMARY KEY,                                        â”‚
    â”‚    code VARCHAR(50) UNIQUE NOT NULL,  -- e.g., "LAUNCH50"         â”‚
    â”‚    description TEXT,                                               â”‚
    â”‚                                                                    â”‚
    â”‚    discount_type ENUM('percentage', 'fixed_amount'),              â”‚
    â”‚    discount_value DECIMAL(10,2),  -- 50 (%), or 25.00 ($)         â”‚
    â”‚                                                                    â”‚
    â”‚    applies_to ENUM('all', 'first_payment', 'recurring'),          â”‚
    â”‚    duration_months INT,  -- NULL = forever                         â”‚
    â”‚                                                                    â”‚
    â”‚    max_redemptions INT,                                            â”‚
    â”‚    times_redeemed INT DEFAULT 0,                                   â”‚
    â”‚                                                                    â”‚
    â”‚    valid_from TIMESTAMP,                                           â”‚
    â”‚    valid_until TIMESTAMP,                                          â”‚
    â”‚    is_active BOOLEAN DEFAULT true,                                 â”‚
    â”‚                                                                    â”‚
    â”‚    stripe_coupon_id VARCHAR(120)  -- Synced with Stripe            â”‚
    â”‚  );                                                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CREATE TABLE coupon_redemptions (                                 â”‚
    â”‚    id CHAR(36) PRIMARY KEY,                                        â”‚
    â”‚    coupon_id CHAR(36),                                             â”‚
    â”‚    org_id CHAR(36),                                                â”‚
    â”‚    redeemed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,                â”‚
    â”‚    discount_applied DECIMAL(10,2),                                 â”‚
    â”‚                                                                    â”‚
    â”‚    FOREIGN KEY (coupon_id) REFERENCES coupons(id)                  â”‚
    â”‚  );                                                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    UI: Apply Promo Code
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Checkout                                  â”‚
    â”‚                                            â”‚
    â”‚  Pro Plan          $99.00/mo               â”‚
    â”‚                                            â”‚
    â”‚  Have a promo code?                        â”‚
    â”‚  [LAUNCH50        ] [Apply]                â”‚
    â”‚                                            â”‚
    â”‚  âœ“ Promo code applied: 50% off first monthâ”‚
    â”‚                                            â”‚
    â”‚  Subtotal:         $99.00                  â”‚
    â”‚  Discount:        -$49.50                  â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”‚
    â”‚  Total today:      $49.50                  â”‚
    â”‚  Then $99/mo starting Feb 1                â”‚
    â”‚                                            â”‚
    â”‚  [Complete Purchase]                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    B. REFERRAL PROGRAM
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Database Tables:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CREATE TABLE referrals (                                          â”‚
    â”‚    id CHAR(36) PRIMARY KEY,                                        â”‚
    â”‚    referrer_org_id CHAR(36),  -- Who sent the referral            â”‚
    â”‚    referee_org_id CHAR(36),   -- Who signed up                    â”‚
    â”‚    referral_code VARCHAR(20) UNIQUE,  -- e.g., "ACME-XYZ123"      â”‚
    â”‚                                                                    â”‚
    â”‚    status ENUM('pending', 'qualified', 'rewarded'),               â”‚
    â”‚    qualified_at TIMESTAMP,  -- When referee paid                   â”‚
    â”‚    rewarded_at TIMESTAMP,                                          â”‚
    â”‚                                                                    â”‚
    â”‚    -- Rewards                                                     â”‚
    â”‚    referrer_reward_type ENUM('credits', 'discount', 'cash'),      â”‚
    â”‚    referrer_reward_amount DECIMAL(10,2),  -- $50 or 1000 credits  â”‚
    â”‚    referee_reward_type ENUM('credits', 'discount'),               â”‚
    â”‚    referee_reward_amount DECIMAL(10,2),   -- $25 or 500 credits   â”‚
    â”‚                                                                    â”‚
    â”‚    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP                  â”‚
    â”‚  );                                                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Referral Flow:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Referrer                 System                   Referee
       â”‚                        â”‚                        â”‚
       â”‚ Generate referral code â”‚                        â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚
       â”‚                        â”‚ Create referral record â”‚
       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
       â”‚ Share: pixell.ai/      â”‚                        â”‚
       â”‚   ref/ACME-XYZ123      â”‚                        â”‚
       â”‚                        â”‚                        â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
       â”‚                        â”‚ Click referral link    â”‚
       â”‚                        â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                        â”‚ Sign up with tracking  â”‚
       â”‚                        â”‚                        â”‚
       â”‚                        â”‚ (30 days later)        â”‚
       â”‚                        â”‚ Referee pays $99       â”‚
       â”‚                        â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                        â”‚ Mark 'qualified'       â”‚
       â”‚                        â”‚                        â”‚
       â”‚ Reward: 1000 credits   â”‚                        â”‚
       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
       â”‚                        â”‚        Reward: 500     â”‚
       â”‚                        â”‚        credits         â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ERROR MONITORING & OBSERVABILITY (SENTRY INTEGRATION)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Sentry Setup:
    â•â•â•â•â•â•â•â•â•â•â•â•â•

    Install:
    â”€â”€â”€â”€â”€â”€â”€â”€
    npm install @sentry/nextjs

    Configuration:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // sentry.server.config.js
    Sentry.init({
      dsn: process.env.SENTRY_DSN,
      tracesSampleRate: 0.1,
      environment: process.env.PIXELL_ENV || 'development',

      beforeSend(event, hint) {
        // Filter out sensitive billing data
        if (event.request?.data) {
          delete event.request.data.stripe_secret;
          delete event.request.data.payment_method;
        }
        return event;
      }
    });

    Error Tracking:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â€¢ Payment processing failures
    â€¢ Webhook delivery failures
    â€¢ Credit balance calculation errors
    â€¢ Auto top-up failures
    â€¢ Email delivery failures

    Custom Dashboards:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Sentry Dashboard: Billing Errors                                 â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
    â”‚                                                                    â”‚
    â”‚  Last 24 Hours:                                                    â”‚
    â”‚  â€¢ Webhook failures:        3 errors  âš ï¸                          â”‚
    â”‚  â€¢ Payment processing:      0 errors  âœ“                           â”‚
    â”‚  â€¢ Credit calculation:      1 error   âš ï¸                          â”‚
    â”‚  â€¢ Auto top-up:             0 errors  âœ“                           â”‚
    â”‚                                                                    â”‚
    â”‚  Recent Errors:                                                    â”‚
    â”‚  [ERROR] Credit balance drift detected (org: abc-123)              â”‚
    â”‚  [ERROR] Webhook retry exhausted (event: evt_xyz)                  â”‚
    â”‚  [WARN]  High auto top-up rate (10 in 1 hour)                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. IMPLEMENTATION TIMELINE - PHASE 2                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    WEEK 5-6: Email Templates & Analytics Foundation
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    âœ“ Create 7 additional email templates (@react-email)
    âœ“ Set up email queue system (async job processing)
    âœ“ Create usage_trends table and data collection job
    âœ“ Create spending_forecasts table
    âœ“ Implement basic forecasting algorithm (linear regression)

    WEEK 7-8: Advanced Analytics Dashboard
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    âœ“ Build analytics UI components (charts, trends)
    âœ“ Implement peak usage heatmap
    âœ“ Team member breakdown with sorting/filtering
    âœ“ Budget alert creation UI
    âœ“ Export to CSV functionality

    WEEK 9-10: Team Quotas & Enterprise Features
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    âœ“ Create user_quotas table and enforcement logic
    âœ“ Build quota management UI
    âœ“ Implement annual billing in Stripe
    âœ“ Create enterprise_plans table
    âœ“ Build custom plan creation workflow (admin)
    âœ“ Multi-currency support (Stripe + pricing table)

    WEEK 11-12: Marketing & Growth Features
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    âœ“ Coupon/promo code system (Stripe integration)
    âœ“ Referral program database & tracking
    âœ“ Referral UI (generate code, share, track)
    âœ“ Invoice customization (logo, notes)
    âœ“ Sentry integration for error tracking
    âœ“ End-to-end testing for all Phase 2 features

    Total Timeline: 8 weeks (2 months)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. NEW API ENDPOINTS - PHASE 2                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Analytics & Forecasting:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    GET    /api/billing/analytics/trends?period=30days
    GET    /api/billing/analytics/forecast?days=30
    GET    /api/billing/analytics/peak-usage
    POST   /api/billing/analytics/budget-alert
    DELETE /api/billing/analytics/budget-alert/:id

    Team Quotas:
    â•â•â•â•â•â•â•â•â•â•â•â•
    GET    /api/billing/quotas                    â†’ All user quotas
    GET    /api/billing/quotas/:userId            â†’ Specific user quota
    PUT    /api/billing/quotas/:userId            â†’ Set user quota
    DELETE /api/billing/quotas/:userId            â†’ Remove quota (unlimited)

    Enterprise:
    â•â•â•â•â•â•â•â•â•â•â•
    POST   /api/billing/enterprise/request        â†’ Request custom plan
    GET    /api/billing/plans/annual              â†’ Annual billing options
    POST   /api/billing/switch-to-annual          â†’ Convert to annual

    Marketing:
    â•â•â•â•â•â•â•â•â•â•
    POST   /api/billing/coupon/apply              â†’ Apply promo code
    POST   /api/billing/referral/generate         â†’ Generate referral code
    GET    /api/billing/referral/stats            â†’ Referral stats
    GET    /api/billing/referral/rewards          â†’ Rewards earned

    Invoice Customization:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    PUT    /api/billing/invoice-settings          â†’ Logo, notes, etc.
```

---

## Phase 2 Summary

**Phase 2 Enhancements** transform the billing system from a functional MVP into a comprehensive, enterprise-grade platform with advanced analytics, granular controls, and growth-oriented features.

### Key Additions:

**1. Enhanced Communication (7 Email Templates)**
- Usage warnings at 80% and 100% thresholds with actionable CTAs
- Auto top-up confirmation with receipt and settings management
- Subscription change notifications (upgrades/downgrades)
- Welcome email for trial signups with getting started guide
- Downgrade notifications when payment fails after grace period

**2. Advanced Analytics & Intelligence**
- Real-time usage trend visualization (daily/weekly/monthly)
- Spending forecasting with confidence scores using linear regression
- Peak usage heatmaps showing hourly patterns across weekdays
- Per-user cost breakdown with sortable tables and CSV export
- Budget alerts with configurable thresholds and email notifications

**3. Granular Control (Team Member Quotas)**
- Per-user credit limits across all action tiers
- Dual-layer enforcement (org-level + user-level)
- Admin UI for setting individual quotas
- User quota usage visibility in analytics dashboard
- Prevents any single user from consuming all org credits

**4. Enterprise Features**
- Annual billing with 16% discount incentive
- Custom enterprise plans with negotiated pricing and allocations
- Multi-currency support (USD/EUR/GBP/CAD/AUD)
- SLA tracking and dedicated support flags
- Invoice customization (company logo, custom notes)

**5. Marketing & Growth**
- Coupon/promo code system with Stripe integration (percentage/fixed discounts)
- Referral program with dual rewards (referrer: 1000 credits, referee: 500 credits)
- Automated qualification tracking (reward after 30 days + payment)
- Unique referral codes per organization

**6. Production Observability**
- Sentry error tracking for payment failures, webhook issues, credit calculations
- Custom dashboards for billing-specific errors
- Automated alerting for webhook retry exhaustion
- PII filtering to protect sensitive payment data

### Technical Implementation:
- **3 new database tables** (usage_trends, spending_forecasts, budget_alerts)
- **4 new tables for features** (user_quotas, enterprise_plans, coupons, referrals)
- **15 new API endpoints** across analytics, quotas, enterprise, and marketing
- **7 React Email templates** with AWS SES delivery
- **Forecasting algorithm** using historical usage patterns
- **Multi-currency pricing table** with Stripe synchronization

### Timeline:
**8 weeks (2 months)** divided into:
- Weeks 5-6: Email templates + analytics foundation
- Weeks 7-8: Dashboard UI + visualization
- Weeks 9-10: Quotas + enterprise features
- Weeks 11-12: Marketing features + Sentry + testing

Phase 2 elevates the billing system from basic subscription management to a data-driven platform with enterprise scalability, user-level governance, and growth acceleration tools.